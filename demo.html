<html>
<head>
<script src="contextfree.js"></script>
<script>
function createCanvas(){
	var c = document.createElement( "canvas" );
	c.id = "canvas";
	c.width = "1000";
	c.height = "1000";
	
	document.getElementById("canvasHolder").appendChild( c );
}

function removeCanvas(){
	var c = document.getElementById("canvas");
	if( c ){
		document.getElementById("canvasHolder").removeChild( c );
	}
}

function render( el ){
	removeCanvas();
	createCanvas();
	
	var t = new Tokenizer();
	var tokens = t.tokenize( el.id );
	console.log( tokens );

	var c = new Compiler();
	var compiled = c.compile( tokens );
	console.log( compiled );
	
	var r = new Renderer( "canvas" );
	r.render( compiled );	
}

</script>
<style>
textarea{ width: 300px; height: 200px;}
</style>
</head>

<body>
<div id="canvasHolder"></div>
<br/>

<!-- Snake -->
<textarea id="snake" ondblclick="render(this);">
startshape starter

rule starter{
 snakeparty{ s .2 }
}
rule snakeparty {
 snake { }
 snakeparty {y 1.0 s 0.95 r -15}
}

rule snakeeye {
  CIRCLE {b 1}
  CIRCLE {b -1 s 0.4 x -0.35}
}

rule snake {
 snaketail { }
 snakeeye {s 0.4 x -0.2 y 0.2}
 snakemouth {x -0.5 y -0.2 s 0.3}
}

rule snaketail {
 CIRCLE {}
 SQUARE {x 0.32 y 0.1 s 0.5 r -30}
 SQUARE {x 0.32 y -0.1 s 0.5 r 30}
 snaketail {x 0.8 s 0.7}
}

rule snakemouth {
 SQUARE {b 1 r 65}
}
</textarea>


<!-- Square Fractal -->
<textarea id="square_fractal" ondblclick="render(this);">
startshape WHOLE
background{ b -1 }

rule WHOLE {
  QUAD { x -0.5 y -0.5 }
  QUAD { x  0.5 y -0.5 }
  QUAD { x  0.5 y  0.5 }
  QUAD { x -0.5 y  0.5 }
}

rule QUAD {
  SQUARE { size 0.8 b 1}
}
rule QUAD 5 {
  WHOLE { size 0.45 r 2 }
}
rule QUAD 0.5 {
}
</textarea>

<!-- Circle -->
<textarea id="circ" ondblclick="render(this);">
startshape circ

rule circ {
 CIRCLE{ sat .3 hue 100 b .5 }
}
</textarea>

<!-- Art Net -->
<textarea id="art_net" ondblclick="render(this);">
startshape net

rule net {
    expand { }
    dot { }
    net { x 1 r 90 s 0.71 b 0.5}
    net { x -1 r 90 s 0.71 b -0.5}
}
rule net {
    expand { }
    dot { }
    net { x 1 r 90 s 0.71 b -0.5}
    net { x -1 r 90 s 0.71 b 0.5}
}

rule expand {
    arm { s 0.1 }
    arm { s 0.1 r 180 }
}


rule dot {
    CIRCLE { s 0.4 }
}
rule dot 0.7 {
    CIRCLE { s 0.565685424949 }
}
rule dot 0.2 {
    CIRCLE { s 0.8 }
}

rule arm {
    SQUARE { }
    SQUARE { x 1 }
    SQUARE { x 2 }
    SQUARE { x 3 }
    SQUARE { x 4 }
    SQUARE { x 5 }
    SQUARE { x 6 }
    SQUARE { x 7 }
    SQUARE { x 8 }
    SQUARE { x 9 }
    SQUARE { x 10 }
}	
</textarea>

<textarea id="flower" ondblclick="render(this);">
startshape D

rule D
{
  C {r 15}
  C {r 45}
}
rule C
{
  B {}
  B {f -90}
}

rule B
{
  A {}
  A {r 60}
  A { r 120 }
  A { r 180 }
  A { r 240 }
  A { r 300 }
}

rule A
{
  CIRCLE {s 1 .0006}
  A {x .9 r 120.21 s .99 b .0005 }
}
</textarea>

<textarea id="o-tree" ondblclick="render(this);">
startshape arbolSizer

rule arbolSizer{
	arbol{ s .08 y -1 }
} 

rule arbol { linea{} arbol {y 1.5 s .99 r 5} }
rule arbol { linea{} arbol {y 1.5 s .99 r -5} }
rule arbol .4 {  circulo {}  arbol {y 1 x -1 r 10 s .8 } 
arbol {y 1 x 1 r -10 s .8 } }
rule linea { SQUARE {s .2 1} }
rule circulo { CIRCLE {} CIRCLE {s .8 b 1 } }
</textarea>	
</body>
</html>
